<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£ - ‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏ô‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        /* Custom scrollbar for horizontal menu sections (optional, but good for aesthetics) */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        /* Custom styles for menu cards to ensure consistent width for horizontal scrolling */
        .menu-card {
            flex: 0 0 auto; /* Prevent items from shrinking */
            width: 280px; /* Fixed width for each card, adjust as needed */
            scroll-snap-align: start; /* Optional: for smoother snapping effect */
            transition: transform 0.2s ease-in-out; /* Smooth hover effect */
        }
        /* Responsive adjustments for menu card width on smaller screens */
        @media (max-width: 640px) {
            .menu-card {
                width: 240px; /* Slightly smaller width for mobile */
            }
        }
        @media (max-width: 480px) {
            .menu-card {
                width: 200px; /* Even smaller for very small screens */
            }
        }
        /* Background for header area - now solid red */
        .header-bg {
            background-color: #DC2626; /* Solid red background */
            color: white;
            padding: 2rem 1rem; /* Adjust padding as needed */
            text-shadow: 1px 1px 4px rgba(0,0,0,0.7); /* Stronger text shadow for readability */
            position: relative; /* Keep relative for z-index of search bar */
        }
        /* Remove overlay as there's no background image */
        .header-bg::before {
            content: none;
        }
        .header-content {
            position: relative;
            z-index: 2; /* Place content above search bar if needed */
        }
        .footer-bg {
            background-color: #333; /* Darker background for footer for better contrast */
            color: white;
            padding: 2.5rem 1.5rem; /* Increased padding */
            font-size: 0.9rem; /* Slightly smaller font for compactness */
        }
        .footer-bg p {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 font-sans text-gray-800">

    <!-- Header Section (adjusted for new design) -->
    <div class="header-bg shadow-lg rounded-b-lg text-white">
        <div class="header-content flex flex-col items-center justify-center text-center p-4">
            <h1 class="font-bold text-4xl mb-2 sm:text-5xl lg:text-6xl">‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏ô‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢</h1>
            <p class="text-xl mb-1 sm:text-2xl">‡∏Å‡∏£‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡πÅ‡∏ó‡πâ ‡πÜ...‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á</p>
            <p class="text-base text-gray-200 sm:text-lg">Â∞ëÁà∑ÊâìÊããÈ•≠-ÁÉ≠ÁÇíÈ¶ôËæ£, Ëá™ÈÄâËæ£Â∫¶</p>
        </div>

        <!-- Search Bar -->
        <div class="px-4 pb-4 mt-8 relative z-20"> <!-- Ensure search bar is above overlay -->
            <div class="relative">
                <!-- Search icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-600"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                <input
                    type="text"
                    id="searchTerm"
                    placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£..."
                    class="w-full pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition-shadow text-base text-gray-800"
                    onkeyup="displayMenuSections()"
                />
            </div>
        </div>
    </div>

    <!-- Promotion Banner -->
    <div class="bg-yellow-200 text-center py-2">
        <p class="font-semibold text-red-700">üî• ‡πÇ‡∏õ‡∏£‡πÉ‡∏´‡∏°‡πà LINE OA ‚Äú‡∏™‡∏±‡πà‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏ä‡∏°. ‡∏•‡∏î‡πÄ‡∏•‡∏¢ 10%‚Äù üî•</p>
        <p class="text-xs text-gray-800 mt-1">
            üïí ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏±‡∏ö‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á<br>
            ‚Ä¢ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î 10% ‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á
        </p>
    </div>

    <!-- Main Menu Sections Container -->
    <div id="menuSectionsContainer" class="p-4 space-y-8">
        <!-- Menu categories and items will be rendered here by JavaScript -->
    </div>

    <!-- Floating button to view order summary -->
    <button id="viewOrderBtn" onclick="openOrderModal()" class="fixed bottom-6 right-6 bg-green-600 text-white rounded-full px-4 py-3 shadow-lg transition-colors">
        ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ
    </button>

    <!-- Order summary modal -->
    <div id="orderModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-4 w-11/12 max-w-lg max-h-[90vh] overflow-y-auto" id="orderSummary">
            <h2 class="text-lg font-bold text-center mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå</h2>
            <ul id="orderList" class="space-y-1 text-sm mb-2"></ul>
            <p id="orderTotal" class="font-medium text-right"></p>
            <div class="mt-4 flex justify-end space-x-2">
        
                <button onclick="shareOrderText()" class="bg-blue-500 text-white px-3 py-1 rounded">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                <button onclick="closeOrderModal()" class="bg-gray-300 text-gray-700 px-3 py-1 rounded">‡∏õ‡∏¥‡∏î</button>
            </div>
        </div>
    </div>

    <!-- Toppings selection modal -->
    <div id="toppingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-4 w-11/12 max-w-sm max-h-[80vh] overflow-y-auto">
            <h2 class="text-lg font-bold text-center mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á</h2>
            <div id="toppingsList" class="space-y-1 text-sm mb-2"></div>
            <div class="mt-4 flex justify-end space-x-2">
                <button onclick="confirmToppings()" class="bg-green-500 text-white px-3 py-1 rounded">‡∏ï‡∏Å‡∏•‡∏á</button>
                <button onclick="closeToppingsModal()" class="bg-gray-300 text-gray-700 px-3 py-1 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            </div>
        </div>
    </div>

    <!-- Footer Section (newly added) -->
    <div class="footer-bg mt-8 rounded-t-lg shadow-lg">
        <div class="max-w-4xl mx-auto p-6 text-center">
            <h3 class="font-bold text-xl mb-4">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h3>
            <div class="space-y-2 text-sm text-gray-200">
                <p><strong>‡πÇ‡∏ó‡∏£:</strong> 061-093-2468</p>
                <p><strong>LINE Official:</strong> @kpnn</p>
                <p>
                    <!-- Placeholder QR Code. Replace with your actual QR code URL. -->
                    <!-- [Image of QR Code] -->
                    <!-- <img src="https://example.com/your-qr-code.png" alt="QR Code" class="mx-auto my-2 rounded-lg w-24 h-24"/> -->
                </p>
                <p><strong>IG:</strong> @kaprao9noi</p>
                <p><strong>‡πÄ‡∏õ‡∏¥‡∏î‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô:</strong> 09:30 - 18:00</p>
                <p><strong>Delivery via:</strong> GrabFood | LINE MAN | 9noi</p>
                <p class="text-sm mt-4 text-gray-300">
                    Mr. Kaprao - Stir-Fried Hot & Fragrant, Spicy as You Like
                </p>
                <p class="text-xs text-gray-400">
                    A new chapter from "Baan Kaprao", Mahasarakham 1997
                </p>
            </div>
            <p class="text-xs text-gray-400 mt-6">&copy; 2024 ‡∏ô‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô. ‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå.</p>
        </div>
    </div>

    <script>
    let menuItems = [];
    const toppings = [
        { name: "‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß", price: 10 },
        { name: "‡πÑ‡∏Ç‡πà‡πÄ‡∏à‡∏µ‡∏¢‡∏ß", price: 10 },
        { name: "‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô ‡∏™‡∏≠‡∏á‡∏ü‡∏≠‡∏á", price: 20 }
    ];

    let searchTerm = '';
    const order = [];
    let currentItemId = null;

    document.addEventListener('DOMContentLoaded', () => {
        fetch('/api/menu-items')
            .then(res => res.json())
            .then(data => {
                menuItems = data;
                displayMenuSections();
            });
        updateOrderButton();
    });

        function updateOrderButton() {
            const btn = document.getElementById('viewOrderBtn');
            const count = order.reduce((s, o) => s + o.qty, 0);
            btn.textContent = count > 0 ? `‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ (${count})` : '‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ';
            btn.classList.toggle('bg-green-600', count === 0);
            btn.classList.toggle('bg-red-500', count > 0);
        }

        function openToppingsModal(id) {
            currentItemId = id;
            const container = document.getElementById('toppingsList');
            container.innerHTML = toppings.map(t => `
                <label class="flex items-center space-x-2">
                    <input type="checkbox" value="${t.name}" data-price="${t.price}" class="topping-checkbox">
                    <span>${t.name} ‡∏ø${t.price}</span>
                </label>
            `).join('');
            document.getElementById('toppingsModal').classList.remove('hidden');
        }

        function closeToppingsModal() {
            document.getElementById('toppingsModal').classList.add('hidden');
        }

        function confirmToppings() {
            const selected = Array.from(document.querySelectorAll('.topping-checkbox:checked')).map(cb => ({
                name: cb.value,
                price: Number(cb.dataset.price)
            }));
            addToOrder(currentItemId, selected);
            closeToppingsModal();
        }

        function addToOrder(id, selectedToppings) {
            const item = menuItems.find(i => i.id === id);
            if (!item) return;
            const key = id + '|' + selectedToppings.map(t => t.name).sort().join('|');
            const existing = order.find(o => o.key === key);
            if (existing) {
                existing.qty += 1;
            } else {
                order.push({ key, item, qty: 1, toppings: selectedToppings });
            }
            updateOrderButton();
        }

        function openOrderModal() {
            renderOrderList();
            document.getElementById('orderModal').classList.remove('hidden');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.add('hidden');
        }

        function increaseQty(index) {
            order[index].qty += 1;
            renderOrderList();
            updateOrderButton();
        }

        function decreaseQty(index) {
            if (order[index].qty > 1) {
                order[index].qty -= 1;
            } else {
                if (confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    order.splice(index, 1);
                }
            }
            renderOrderList();
            updateOrderButton();
        }

        function removeOrder(index) {
            if (confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                order.splice(index, 1);
                renderOrderList();
                updateOrderButton();
            }
        }

        function renderOrderList() {
            const list = document.getElementById('orderList');
            const totalEl = document.getElementById('orderTotal');
            list.innerHTML = '';
            let total = 0;
            order.forEach(({ item, qty, toppings }, index) => {
                const li = document.createElement('li');
                const itemPrice = typeof item.price === 'number' ? item.price : 0;
                const toppingPrice = (toppings || []).reduce((s, t) => s + t.price, 0);
                const toppingText = (toppings || []).map(t => t.name).join(', ');
                li.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="font-medium">${item.id}</span> ${item.name}${toppingText ? ' [' + toppingText + ']' : ''}
                            <div class="text-xs text-gray-500">‡∏ø${itemPrice} + ‡∏ø${toppingPrice}</div>
                        </div>
                        <div class="flex items-center space-x-1">
                            <button onclick="decreaseQty(${index})" class="px-2 bg-gray-200 rounded">-</button>
                            <span>${qty}</span>
                            <button onclick="increaseQty(${index})" class="px-2 bg-gray-200 rounded">+</button>
                            <button onclick="removeOrder(${index})" class="px-2 text-red-600">√ó</button>
                        </div>
                    </div>`;
                total += (itemPrice + toppingPrice) * qty;
                list.appendChild(li);
            });
            totalEl.textContent = `‡∏£‡∏ß‡∏° ${total} ‡∏ö‡∏≤‡∏ó`;
        }

        function shareOrderText() {
            renderOrderList();
            const totalText = document.getElementById('orderTotal').textContent;
            let text = 'üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå\n';
            order.forEach(({ item, qty, toppings }) => {
                const toppingPrice = (toppings || []).reduce((s, t) => s + t.price, 0);
                const itemPrice = typeof item.price === 'number' ? item.price : 0;
                const priceText = `‡∏ø${(itemPrice + toppingPrice) * qty}`;
                const toppingText = (toppings || []).map(t => t.name).join(', ');
                text += `üîπ ${item.id} ${item.name}${toppingText ? ' [' + toppingText + ']' : ''} x${qty} ${priceText}\n`;
            });
            text += `üí∞${totalText}`;
            const encoded = encodeURIComponent(text);
            if (/Line/i.test(navigator.userAgent)) {
                window.location.href = `line://oaMessage/@kpnn/?${encoded}`;
            } else {
                navigator.clipboard.writeText(text).then(() => alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏•‡πâ‡∏ß'));
            }
        }

        function downloadOrderImage() {
            html2canvas(document.getElementById('orderSummary')).then(canvas => {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'order-summary.png';
                link.click();
            });
        }

        // Function to render a single menu item HTML card
        function renderMenuItemCard(item) {
            // Determine the display name: Thai if Chinese not present, else both
            const displayName = item.chineseName ? `${item.name} / ${item.chineseName}` : item.name;

            return `
                <div class="menu-card bg-white rounded-lg shadow-md border border-gray-100 overflow-hidden transform transition-transform duration-200 hover:scale-105">
                    <div class="p-2">
                        <img
                            src="${item.image}"
                            alt="${item.name}"
                            class="w-full h-32 object-cover rounded-md mb-3"
                            onerror="this.onerror=null;this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNGM0Y0RjYiLz48cGF0aCBkPSJNNTAgNjVMNDAgNDBINjBMNTAgNjVaIiBmaWxsPSIjOUNBM0FGIi8+PC9zdmc+';"
                        />
                        <div class="flex items-center justify-between mb-1">
                            <h3 class="font-semibold text-gray-900 text-base leading-tight line-clamp-2">${displayName}</h3>
                            <span class="text-sm font-medium text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full">${item.id}</span>
                        </div>
                        <p class="text-gray-600 text-xs mb-2 line-clamp-2">${item.description}</p>
                        <div class="flex items-center justify-between mt-auto">
                            <span class="text-lg font-bold text-green-600">${typeof item.price === 'number' ? '‡∏ø' + item.price : item.price}</span>
                            <button onclick="openToppingsModal('${item.id}')" class="ml-2 bg-green-500 text-white px-2 py-1 rounded text-sm">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Function to display menu sections with horizontal scrolling
        function displayMenuSections() {
            const container = document.getElementById('menuSectionsContainer');
            if (!container) return;

            searchTerm = document.getElementById('searchTerm').value.toLowerCase();

            // Filter all menu items first based on the search term
            const globallyFilteredItems = menuItems.filter(item =>
                item.name.toLowerCase().includes(searchTerm) ||
                (item.chineseName && item.chineseName.toLowerCase().includes(searchTerm)) || // Search Chinese name
                item.description.toLowerCase().includes(searchTerm) ||
                item.category.toLowerCase().includes(searchTerm) ||
                item.id.toLowerCase().includes(searchTerm) // Allow searching by ID
            );

            // Get unique categories from the filtered items, maintaining original order
            const orderedCategories = [
                '‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ | ÊâìÊäõÈ•≠',
                '‡∏™‡∏õ‡∏≤‡πÄ‡∏Å‡πá‡∏ï‡∏ï‡∏µ‡πâ‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤ | ËíúËìâÁÇíÊÑèÈù¢',
                '‡∏Ç‡πâ‡∏≤‡∏ß‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô ‡∏ó‡∏≠‡∏î‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏° | ËíúËìâÊªëËõãÈ•≠',
                '‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡πà‡∏≠‡∏´‡∏°‡∏Å‡πÑ‡∏Ç‡πà‡∏Ç‡πâ‡∏ô | ÂíñÂñ±ÊªëËõãÈ•≠',
                '‡∏ú‡∏•‡πÑ‡∏°‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≤‡∏ô | È≤úÂàáÊ∞¥Êûú',
                '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏° | È•ÆÂìÅ'
            ];

            let htmlContent = '';
            let foundItems = false;

            orderedCategories.forEach(categoryName => {
                const itemsInCategory = globallyFilteredItems.filter(item => item.category === categoryName);
                
                if (itemsInCategory.length > 0) {
                    foundItems = true;
                    htmlContent += `
                        <div class="category-section">
                            <h2 class="font-bold text-xl text-gray-900 mb-4 px-2">${categoryName}</h2>
                            <div class="flex overflow-x-auto space-x-4 pb-4 px-2 no-scrollbar">
                                ${itemsInCategory.map(renderMenuItemCard).join('')}
                            </div>
                        </div>
                    `;
                }
            });

            if (!foundItems) {
                htmlContent = `
                    <div class="text-center py-20 text-gray-600">
                        <p class="text-xl font-medium">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</p>
                        <p class="text-sm mt-2">‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                `;
            }
            
            container.innerHTML = htmlContent;
        }

        // Initial render when the page loads
    </script>
</body>
</html>
